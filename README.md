# Serial Project Transfer Demo

This repository contains a demonstration project showcasing how to transfer a compiled UnicView Studio project to a display via serial communication using the Lumen Protocol library.

---

## Why This Demo Is Important

This feature is crucial for scenarios requiring remote project updates. In such cases, transferring the project through conventional methods, like using an SD Card, is often not feasible or practical. This demo provides a robust solution for deploying new display project updates over a network.

---

## How It Works

This demonstration utilizes an ESP32 microcontroller to simulate a remote update scenario. The ESP32, equipped with a Wi-Fi module, downloads the compiled project file from a network URL and then transmits it serially to the Lumen display.

The core process involves:

1. **Wi-Fi Connection**: The ESP32 connects to a specified Wi-Fi network to access the project file.  
2. **Project Download**: It downloads the compiled project file (typically .lumen format) from a remote server using HTTP.  
3. **Double Buffering for Efficiency**: To optimize the transfer speed, the demo employs a double buffering technique. This means that while one block of data is being sent to the display, the next block is simultaneously being downloaded from the internet. This overlap minimizes idle time, ensuring a continuous flow of data.  
4. **Serial Transfer via Lumen Protocol**: The downloaded data is then sent to the display via its serial interface, managed by the Lumen Protocol library.

---

## Key Lumen Protocol Functions Used

To facilitate the project transfer, the demo interacts with the Lumen Protocol library through specific functions:

- `lumen_project_update_send_data(data, length)`: This function is responsible for sending chunks of the compiled project data to the display. It's called repeatedly until the entire project is transferred.  
- `lumen_project_update_tick()`: It's essential to continuously call this function. It updates the internal state of the Lumen Protocol library, allowing it to process incoming responses from the display and manage the communication flow.  
- `lumen_project_update_finish()`: Once all project data has been successfully sent, this function must be called to signal the completion of the transfer process to the Lumen Protocol library.

---

## Crucial Timing for Successful Transfer

A critical aspect for successful project transfer is the timing of the initial data transmission. The `lumen_project_update_send_data()` function must be initiated precisely when the display is powering on (before it internally attempts to load any project stored in its memory). This ensures the display enters the correct mode to receive the new project.

To achieve this, the demo code includes a step to send a reboot command to the display immediately before initiating the calls to `lumen_project_update_send_data()`. This guarantees that the display is in the optimal state for receiving the update. This reboot command is sent only once at the beginning of the transfer process.

> Alternatively, you can trigger a reboot by using the **hardware reset pins** available on the display. This involves briefly shorting the reset pin to ground to manually restart the device. This method ensures the display restarts, even without using serial commands.

> When using the serial reboot method, it is **very important** to define the `REBOOT_ADDRESS` to match the address of the **System Variable Reboot** in the currently running project on the display (i.e., the project loaded before starting the transfer). If this address is incorrect, the reboot command will not be recognized, and the display will not restart, causing the transfer to fail.

---

## Project File Information

The data transferred to the display corresponds to the `internal_project.lumen` file. This file is the compiled project generated by the UnicView Studio software when the project is compiled in "Internal Memory" mode.

---

## How to Use This Demo

You can select which project URL to use for the transfer by modifying the `SELECTED_PROJECT_INDEX` variable in the `serial-wifi-project-transfer-demo.ino` file. The `PROJECT_URLS` array contains multiple placeholder links, allowing you to easily switch between different project files for demonstration purposes.
